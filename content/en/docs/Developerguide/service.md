# service<a name="EN-US_TOPIC_0000001243876531"></a>

This subcommand can be used to initialize the configuration directory and start and stop background tasks.

## Initializing the Configuration Directory<a name="section47761656204915"></a>

You can run the  **gs\_dbmind service setup**  subcommand to initialize the configuration directory. This directory may contain the configuration files and logs of the DBMind. Some files in the directory are described as follows:

-   **dbmind.conf**: DBMind parameter configuration file. You can modify it using the  **gs\_dbmind set**  command or a text editor.
-   **dynamic\_config.db**: DBMind service metadata stored on the local node, including algorithm hyperparameters and monitoring thresholds. This file contains DBMind service metadata and cannot be configured by users.
-   **metric\_map.conf**: monitoring metric mapping table, which can be used to adapt to different collection platforms. For example, in DBMind, the monitored system CPU usage is named  **os\_cpu\_usage**, but a user-defined collection tool may name the CPU usage  **my\_cpu\_usage\_rate**. In this case, if you want DBMind to represent the CPU usage  **metric my\_cpu\_usage\_rate**, you need to modify this configuration item. That is, add the  **os\_cpu\_usage = my\_cpu\_usage\_rate**  configuration item for mapping. For common users, you are advised to use the collection component and solution of the DBMind. In this case, you do not need to modify the configuration file.
-   **logs**: This directory stores logs generated by the DBMind service.

You can initialize the configuration directory in interactive or non-interactive mode. For example, if the name of the configuration directory to be initialized is  **confpath**, perform the following operations:

**Interactive mode**

```
gs_dbmind service setup -c confpath --interactive
```

After running the preceding command, you can configure the configuration items in interactive mode through the CLI client.

**Non-interactive mode**

In non-interactive mode, the initialization consists of three steps: starting configuration, modifying configuration items, and initializing configuration. In the second step, you need to manually edit the configuration file by using the text editor. The procedure is as follows:

1.  Run the following command to start the configuration:

    ```
    gs_dbmind service setup -c confpath
    ```

2.  After the preceding command is executed, the  **dbmind.conf**  configuration file is generated in the  **confpath**  directory. You need to use the text editor to manually modify the file. The following parameters need to be modified:  **\[TSDB\]**,  **\[METADATABASE\]**, and  **\[SELF-MONITORING\]**.

    ```
    [TSDB] # Information about the time series database, that is, information about the metric data source.
    name = prometheus # Time series database type. Currently, only prometheus is supported.
    host = # IP address of the time series database.
    port = # Port number of the time series database.
     
    [METADATABASE] # Metadata database information and prediction result storage mode.
    dbtype = # Metadata database type. The options are sqlite, opengauss, and postgresql. If the configuration item name is opengauss, pay attention to the Python driver. For details, see the following information about the Python driver.
    host = #IP address of the metadata database.
    port = # Port number of the metadata database.
    username = # Metadata database user information.
    password = # Metadata database password, which will be encrypted for storage.
    database = # Metadata database name. If the database type is SQLite, you only need to set this parameter. The DBMind generates the SQLite database file with the corresponding file name in the configuration directory according to the value of the database configuration item.
     
    [SELF-MONITORING] # Self-monitoring parameter.
    detection_interval = 600 # Interval for performing health check on openGauss (used only for slow SQL root cause diagnosis), in seconds.
    last_detection_time = 600 # Duration of data monitoring for health check (used only for slow SQL root cause diagnosis), in seconds.
    forecasting_future_time = 3600  # Duration of time series prediction (for time series prediction only) and scheduling period of the prediction function, in seconds.
    # KPIs to be predicted (for time series prediction only)
    golden_kpi = os_cpu_usage, os_mem_usage, gaussdb_qps_by_instance
     
    [LOG] # Log information
    maxbytes = 10485760 # Maximum size of a log file. The default value is 10 MB. If the value of maxbytes is 0, the file size increases infinitely. It is recommended that you retain the default value.
    backupcount = 1 # Maximum number of log files.
    level = INFO # Log level. It can be set to DEBUG, INFO, WARNING, or ERROR.
    ```

3.  After manually modifying the preceding parameters, initialize the configuration items. In this phase, DBMind preliminarily checks the correctness of the configuration items, encrypts the plaintext passwords in the configuration items, and initializes the metadata database for storing the result data.

    ```
    gs_dbmind service setup --initialize -c confpath
    ```

4.  Start the DBMind background service based on the configuration directory.

>![](public_sys-resources/icon-note.gif) **NOTE:** 
>1. The comments in the configuration file are used to prompt users in interactive mode. Do not manually modify or delete the comments.
>2. Make sure that the value of the configuration item and the comment are separated by a space. Otherwise, the system regards the comment as the value of the configuration item.
>3. If special characters in a configuration item need to be escaped, use the percent sign \( %\) to escape the special characters. For example, if the password is  **password %**, use the percent sign \( %\) to escape the special characters, that is,  **password %%**.

## Starting a Service<a name="section165401522192514"></a>

After the configuration directory is initialized, you can start the DBMind background service based on the configuration directory. For example, if the configuration directory is  **confpath**, run the following command:

```
gs_dbmind service start -c confpath
```

After the preceding command is executed, the system displays a message indicating that the service has been started. If no additional parameter is specified, this command starts all background tasks by default. If you want to start only one background task, add the  **--only-run**  option. For example, if you only want to start the slow SQL root cause analysis service, run the following command:

```
gs_dbmind service start -c confpath --only-run slow_query_diagnosis
```

## Stopping a Service<a name="section5774204123013"></a>

Similar to starting a service, stopping a service has a simpler command line structure. You only need to specify the address of the configuration directory. For example, if the configuration directory is  **confpath**, run the following command:

```
gs_dbmind service stop -c confpath
```

The DBMind service automatically exits after the running task is complete in the background.

>![](public_sys-resources/icon-caution.gif) **CAUTION:** 
>-   The metabase user in  **\[METADATABASE\]**  must have the permission to create tables and insert and update data in the database. Otherwise, an exception will occur during tool execution.
>-   Currently, multiple services cannot be started separately using the same configuration file.
>-   The tool provides the  **requirement.txt**  file. You can use this file to install required third-party dependencies.

## Command Reference<a name="section272822583215"></a>

You can use the  **--help**  option to obtain the help information about this mode. For example:

```
gs_dbmind service --help
```

```
usage: service [-h] -c DIRECTORY [--only-run {slow_query_diagnosis,forecast}] [--interactive | --initialize] {setup,start,stop}

positional arguments:
  {setup,start,stop}
                        perform an action for service

optional arguments:
  -h, --help            show this help message and exit
  -c DIRECTORY, --conf DIRECTORY
                        set the directory of configuration files
  --only-run {slow_query_diagnosis,forecast}
                        explicitly set a certain task running in the backend
  --interactive         configure and initialize with interactive mode
  --initialize          initialize and check configurations after configuring.
```

**Table  1**  Parameters of the gs\_dbmind service subcommand

<a name="en-us_topic_0283137337_table628178124515"></a>
<table><thead align="left"><tr id="en-us_topic_0283137337_row162968174512"><th class="cellrowborder" valign="top" width="33.3033303330333%" id="mcps1.2.4.1.1"><p id="en-us_topic_0283137337_p1129138144517"><a name="en-us_topic_0283137337_p1129138144517"></a><a name="en-us_topic_0283137337_p1129138144517"></a>Parameter</p>
</th>
<th class="cellrowborder" valign="top" width="33.36333633363336%" id="mcps1.2.4.1.2"><p id="en-us_topic_0283137337_p2029181454"><a name="en-us_topic_0283137337_p2029181454"></a><a name="en-us_topic_0283137337_p2029181454"></a>Description</p>
</th>
<th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.2.4.1.3"><p id="en-us_topic_0283137337_p6291382451"><a name="en-us_topic_0283137337_p6291382451"></a><a name="en-us_topic_0283137337_p6291382451"></a>Value Range</p>
</th>
</tr>
</thead>
<tbody><tr id="row16616112314312"><td class="cellrowborder" valign="top" width="33.3033303330333%" headers="mcps1.2.4.1.1 "><p id="p6616122313314"><a name="p6616122313314"></a><a name="p6616122313314"></a>action</p>
</td>
<td class="cellrowborder" valign="top" width="33.36333633363336%" headers="mcps1.2.4.1.2 "><p id="p5616423334"><a name="p5616423334"></a><a name="p5616423334"></a>Action parameter</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><a name="ul613179154816"></a><a name="ul613179154816"></a><ul id="ul613179154816"><li><strong id="b191741617399"><a name="b191741617399"></a><a name="b191741617399"></a>setup</strong>: initializes configuration directory.</li><li><strong id="b106913193396"><a name="b106913193396"></a><a name="b106913193396"></a>start</strong>: starts a service.</li><li><strong id="b17663021153920"><a name="b17663021153920"></a><a name="b17663021153920"></a>stop</strong>: stops a service.</li></ul>
</td>
</tr>
<tr id="row185495841018"><td class="cellrowborder" valign="top" width="33.3033303330333%" headers="mcps1.2.4.1.1 "><p id="p116122412518"><a name="p116122412518"></a><a name="p116122412518"></a>-c, --conf</p>
</td>
<td class="cellrowborder" valign="top" width="33.36333633363336%" headers="mcps1.2.4.1.2 "><p id="p184721720498"><a name="p184721720498"></a><a name="p184721720498"></a>Configuration file directory</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p7214115063313"><a name="p7214115063313"></a><a name="p7214115063313"></a>-</p>
</td>
</tr>
<tr id="row105517375810"><td class="cellrowborder" valign="top" width="33.3033303330333%" headers="mcps1.2.4.1.1 "><p id="p195619371187"><a name="p195619371187"></a><a name="p195619371187"></a>--initialize</p>
</td>
<td class="cellrowborder" valign="top" width="33.36333633363336%" headers="mcps1.2.4.1.2 "><p id="p1561937283"><a name="p1561937283"></a><a name="p1561937283"></a>Initializes configuration parameters.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p113091138786"><a name="p113091138786"></a><a name="p113091138786"></a>-</p>
</td>
</tr>
<tr id="row03641458113510"><td class="cellrowborder" valign="top" width="33.3033303330333%" headers="mcps1.2.4.1.1 "><p id="p113642586354"><a name="p113642586354"></a><a name="p113642586354"></a>--interactive</p>
</td>
<td class="cellrowborder" valign="top" width="33.36333633363336%" headers="mcps1.2.4.1.2 "><p id="p133651958103518"><a name="p133651958103518"></a><a name="p133651958103518"></a>Configures parameters in interactive mode.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="p1136545823511"><a name="p1136545823511"></a><a name="p1136545823511"></a>-</p>
</td>
</tr>
<tr id="row106196521215"><td class="cellrowborder" valign="top" width="33.3033303330333%" headers="mcps1.2.4.1.1 "><p id="p27171031065"><a name="p27171031065"></a><a name="p27171031065"></a>--only-run</p>
</td>
<td class="cellrowborder" valign="top" width="33.36333633363336%" headers="mcps1.2.4.1.2 "><p id="p161918501220"><a name="p161918501220"></a><a name="p161918501220"></a>Selects the module to be run only.</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><a name="ul9105143317480"></a><a name="ul9105143317480"></a><ul id="ul9105143317480"><li><strong id="b3613820412"><a name="b3613820412"></a><a name="b3613820412"></a>forecast</strong>: prediction module.</li><li><strong id="b4504852124019"><a name="b4504852124019"></a><a name="b4504852124019"></a>slow_query_diagnosis</strong>: root cause analysis module for slow SQL statements.</li></ul>
</td>
</tr>
<tr id="en-us_topic_0283137337_row162915844513"><td class="cellrowborder" valign="top" width="33.3033303330333%" headers="mcps1.2.4.1.1 "><p id="en-us_topic_0283137337_p132968134510"><a name="en-us_topic_0283137337_p132968134510"></a><a name="en-us_topic_0283137337_p132968134510"></a>-h, --help</p>
</td>
<td class="cellrowborder" valign="top" width="33.36333633363336%" headers="mcps1.2.4.1.2 "><p id="en-us_topic_0283137337_p152474092416"><a name="en-us_topic_0283137337_p152474092416"></a><a name="en-us_topic_0283137337_p152474092416"></a>Help information</p>
</td>
<td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.2.4.1.3 "><p id="en-us_topic_0283137337_p94668717174"><a name="en-us_topic_0283137337_p94668717174"></a><a name="en-us_topic_0283137337_p94668717174"></a>-</p>
</td>
</tr>
</tbody>
</table>

