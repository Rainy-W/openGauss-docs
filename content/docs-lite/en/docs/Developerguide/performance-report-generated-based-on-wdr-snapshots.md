# Performance Report Generated Based on WDR Snapshots<a name="EN-US_TOPIC_0289900439"></a>

A performance report is generated by summarizing and collecting statistics based on WDR snapshot data tables.

## Prerequisites<a name="en-us_topic_0283137259_section128252205291"></a>

The WDR snapshots have been started \([**enable\_wdr\_snapshot**](system-performance-snapshot.md#en-us_topic_0283137284_en-us_topic_0237124757_section983311682019)  is set to  **on**\) and the number of snapshots is greater than or equal to 2.

## Procedure<a name="en-us_topic_0283137259_section49941629132915"></a>

1.  Run the following command to connect to the  **postgres**  database.

    ```
    gsql -d postgres -p [Port number] -r
    ```

2.  Run the following command to query the generated snapshot and obtain  **snapshot\_id**:

    ```
    select * from snapshot.snapshot;
    ```

3.  \(Optional\) Run the following command on the CCN to manually create a snapshot. If only one snapshot exists in the database or you want to view the monitoring data of the database in the current period, manually create a snapshot. This command is only available to users with the  **sysadmin**  permission.

    ```
    select create_wdr_snapshot();
    ```

    >![](public_sys-resources/icon-note.gif) **NOTE:** 
    >Run the  **cm\_ctl query -Cdvi**  command. In the command output, the information under  **Central Coordinator State**  is the CCN information.

4.  Generate a performance report.
    1.  Run the following command to generate a formatted performance report file:

        ```
        \a \t \o Server file path
        ```

        The parameters in the preceding command are described as follows:

        -   **\\a**: switches the unaligned mode.
        -   **\\t**: switches the information and row count footer of the output column name.
        -   **\\o**: specifies that all the query results are sent to the server file.
        -   _Server file path_: indicates the path for storing the generated performance report file. The user must have the read and write permissions on the path.

    2.  Run the following command to write the queried information to the performance report:

        ```
        select generate_wdr_report(begin_snap_id bigint, end_snap_id bigint, report_type cstring, report_scope cstring, node_name cstring);
        ```

        The description of the parameters in the preceding command is as follows: 

        **Table  1**  Parameters of the generate\_wdr\_report function

        <a name="en-us_topic_0283137259_table5333144711537"></a>
        <table><thead align="left"><tr id="en-us_topic_0283137259_row040934711539"><th class="cellrowborder" valign="top" width="34.01010101010101%" id="mcps1.2.4.1.1"><p id="en-us_topic_0283137259_p2409447155310"><a name="en-us_topic_0283137259_p2409447155310"></a><a name="en-us_topic_0283137259_p2409447155310"></a>Parameter</p>
        </th>
        <th class="cellrowborder" valign="top" width="32.56565656565657%" id="mcps1.2.4.1.2"><p id="en-us_topic_0283137259_p10409154795317"><a name="en-us_topic_0283137259_p10409154795317"></a><a name="en-us_topic_0283137259_p10409154795317"></a>Description</p>
        </th>
        <th class="cellrowborder" valign="top" width="33.42424242424243%" id="mcps1.2.4.1.3"><p id="en-us_topic_0283137259_p940974711533"><a name="en-us_topic_0283137259_p940974711533"></a><a name="en-us_topic_0283137259_p940974711533"></a>Value Range</p>
        </th>
        </tr>
        </thead>
        <tbody><tr id="en-us_topic_0283137259_row540954735315"><td class="cellrowborder" valign="top" width="34.01010101010101%" headers="mcps1.2.4.1.1 "><p id="en-us_topic_0283137259_p3409194710533"><a name="en-us_topic_0283137259_p3409194710533"></a><a name="en-us_topic_0283137259_p3409194710533"></a>begin_snap_id</p>
        </td>
        <td class="cellrowborder" valign="top" width="32.56565656565657%" headers="mcps1.2.4.1.2 "><p id="en-us_topic_0283137259_p14093472535"><a name="en-us_topic_0283137259_p14093472535"></a><a name="en-us_topic_0283137259_p14093472535"></a>ID of a snapshot when a query starts, which is specified by <strong id="b20011237201"><a name="b20011237201"></a><a name="b20011237201"></a>snapshot_id</strong> in the <strong id="b17248162919209"><a name="b17248162919209"></a><a name="b17248162919209"></a>snapshot.snaoshot</strong> table.</p>
        </td>
        <td class="cellrowborder" valign="top" width="33.42424242424243%" headers="mcps1.2.4.1.3 "><p id="en-us_topic_0283137259_p1740916478538"><a name="en-us_topic_0283137259_p1740916478538"></a><a name="en-us_topic_0283137259_p1740916478538"></a>-</p>
        </td>
        </tr>
        <tr id="en-us_topic_0283137259_row1640964715530"><td class="cellrowborder" valign="top" width="34.01010101010101%" headers="mcps1.2.4.1.1 "><p id="en-us_topic_0283137259_p11409947115314"><a name="en-us_topic_0283137259_p11409947115314"></a><a name="en-us_topic_0283137259_p11409947115314"></a>end_snap_id</p>
        </td>
        <td class="cellrowborder" valign="top" width="32.56565656565657%" headers="mcps1.2.4.1.2 "><p id="en-us_topic_0283137259_p17410114711536"><a name="en-us_topic_0283137259_p17410114711536"></a><a name="en-us_topic_0283137259_p17410114711536"></a>ID of a snapshot when a query ends. By default, the value of <strong id="b17971772216"><a name="b17971772216"></a><a name="b17971772216"></a>end_snap_id</strong> is greater than that of <strong id="b17538182772217"><a name="b17538182772217"></a><a name="b17538182772217"></a>begin_snap_id table</strong> (<strong id="b14512491487"><a name="b14512491487"></a><a name="b14512491487"></a>snapshot_id</strong> in the <strong id="b991185112486"><a name="b991185112486"></a><a name="b991185112486"></a>begin_snap_id table</strong>).</p>
        </td>
        <td class="cellrowborder" valign="top" width="33.42424242424243%" headers="mcps1.2.4.1.3 "><p id="en-us_topic_0283137259_p541054716536"><a name="en-us_topic_0283137259_p541054716536"></a><a name="en-us_topic_0283137259_p541054716536"></a>-</p>
        </td>
        </tr>
        <tr id="en-us_topic_0283137259_row74101947205320"><td class="cellrowborder" valign="top" width="34.01010101010101%" headers="mcps1.2.4.1.1 "><p id="en-us_topic_0283137259_p174101447205314"><a name="en-us_topic_0283137259_p174101447205314"></a><a name="en-us_topic_0283137259_p174101447205314"></a>report_type</p>
        </td>
        <td class="cellrowborder" valign="top" width="32.56565656565657%" headers="mcps1.2.4.1.2 "><p id="en-us_topic_0283137259_p1410847175318"><a name="en-us_topic_0283137259_p1410847175318"></a><a name="en-us_topic_0283137259_p1410847175318"></a>Type of the generated report. The value can be <strong id="b1380403463019"><a name="b1380403463019"></a><a name="b1380403463019"></a>summary</strong>, <strong id="b144019385308"><a name="b144019385308"></a><a name="b144019385308"></a>detail</strong>, or <strong id="b2426344133010"><a name="b2426344133010"></a><a name="b2426344133010"></a>all</strong>.</p>
        </td>
        <td class="cellrowborder" valign="top" width="33.42424242424243%" headers="mcps1.2.4.1.3 "><a name="en-us_topic_0283137259_ul27626140555"></a><a name="en-us_topic_0283137259_ul27626140555"></a><ul id="en-us_topic_0283137259_ul27626140555"><li><strong id="b134828115318"><a name="b134828115318"></a><a name="b134828115318"></a>summary</strong>: summary data</li><li><strong id="b129231013183120"><a name="b129231013183120"></a><a name="b129231013183120"></a>detail</strong>: detailed data</li><li><strong id="b59841116193118"><a name="b59841116193118"></a><a name="b59841116193118"></a>all</strong>: summary data and detailed data</li></ul>
        </td>
        </tr>
        <tr id="en-us_topic_0283137259_row8410174755319"><td class="cellrowborder" valign="top" width="34.01010101010101%" headers="mcps1.2.4.1.1 "><p id="en-us_topic_0283137259_p8410947105319"><a name="en-us_topic_0283137259_p8410947105319"></a><a name="en-us_topic_0283137259_p8410947105319"></a>report_scope</p>
        </td>
        <td class="cellrowborder" valign="top" width="32.56565656565657%" headers="mcps1.2.4.1.2 "><p id="en-us_topic_0283137259_p44101747145316"><a name="en-us_topic_0283137259_p44101747145316"></a><a name="en-us_topic_0283137259_p44101747145316"></a>Range of the generated report. The value can be <strong id="b135771333321"><a name="b135771333321"></a><a name="b135771333321"></a>cluster</strong> or <strong id="b1411313520321"><a name="b1411313520321"></a><a name="b1411313520321"></a>node</strong>.</p>
        </td>
        <td class="cellrowborder" valign="top" width="33.42424242424243%" headers="mcps1.2.4.1.3 "><a name="en-us_topic_0283137259_ul1630372943913"></a><a name="en-us_topic_0283137259_ul1630372943913"></a><ul id="en-us_topic_0283137259_ul1630372943913"><li><strong id="b126041538193217"><a name="b126041538193217"></a><a name="b126041538193217"></a>cluster</strong>: database-level information</li><li><strong id="b46101246133217"><a name="b46101246133217"></a><a name="b46101246133217"></a>node</strong>: node-level information</li></ul>
        </td>
        </tr>
        <tr id="en-us_topic_0283137259_row1841064716537"><td class="cellrowborder" valign="top" width="34.01010101010101%" headers="mcps1.2.4.1.1 "><p id="en-us_topic_0283137259_p11410194725316"><a name="en-us_topic_0283137259_p11410194725316"></a><a name="en-us_topic_0283137259_p11410194725316"></a>node_name</p>
        </td>
        <td class="cellrowborder" valign="top" width="32.56565656565657%" headers="mcps1.2.4.1.2 "><p id="en-us_topic_0283137259_p9831125295619"><a name="en-us_topic_0283137259_p9831125295619"></a><a name="en-us_topic_0283137259_p9831125295619"></a>When <strong id="b1398604914458"><a name="b1398604914458"></a><a name="b1398604914458"></a>report_scope</strong> is set to <strong id="b1987134910453"><a name="b1987134910453"></a><a name="b1987134910453"></a>node</strong>, set this parameter to the name of the corresponding node. (You can run the <strong id="b1597191153317"><a name="b1597191153317"></a><a name="b1597191153317"></a>select * from pg_node_env;</strong> command to query the node name.)</p>
        <p id="en-us_topic_0283137259_p941074755313"><a name="en-us_topic_0283137259_p941074755313"></a><a name="en-us_topic_0283137259_p941074755313"></a>If <strong id="b161053263330"><a name="b161053263330"></a><a name="b161053263330"></a>report_scope</strong> is set to <strong id="b11721152833318"><a name="b11721152833318"></a><a name="b11721152833318"></a>cluster</strong>, this parameter can be omitted, left blank, or set to <strong id="b9937839183313"><a name="b9937839183313"></a><a name="b9937839183313"></a>NULL</strong>.</p>
        </td>
        <td class="cellrowborder" valign="top" width="33.42424242424243%" headers="mcps1.2.4.1.3 "><a name="en-us_topic_0283137259_ul481800164318"></a><a name="en-us_topic_0283137259_ul481800164318"></a><ul id="en-us_topic_0283137259_ul481800164318"><li><strong id="b125176436331"><a name="b125176436331"></a><a name="b125176436331"></a>node</strong>: a node name in <span id="text1798254510538"><a name="text1798254510538"></a><a name="text1798254510538"></a>openGauss</span></li><li><strong id="b937002419350"><a name="b937002419350"></a><a name="b937002419350"></a>cluster</strong>: This value is omitted, left blank or set to <strong id="b18649102613510"><a name="b18649102613510"></a><a name="b18649102613510"></a>NULL</strong>.</li></ul>
        </td>
        </tr>
        </tbody>
        </table>

    3.  Disable the output options and format the output.

        ```
        \o \a \t 
        ```

5.  [View the WDR](wdrs.md)  as required.

## Example<a name="en-us_topic_0283137259_section65481355161913"></a>

```
-- Query the snapshots that have been generated.
openGauss=# select * from snapshot.snapshot;
 snapshot_id |           start_ts            |            end_ts             
-------------+-------------------------------+-------------------------------
           1 | 2020-09-07 10:20:36.763244+08 | 2020-09-07 10:20:42.166511+08
           2 | 2020-09-07 10:21:13.416352+08 | 2020-09-07 10:21:19.470911+08
(2 rows)

-- Generate the formatted performance report wdrTestNode.html.
openGauss=# \a \t \o /home/om/wdrTestNode.html
Output format is unaligned.
Showing only tuples.

-- Write data into the performance report wdrTestNode.html.
openGauss=# select generate_wdr_report(1, 2, 'all', 'node', 'dn');

-- Close the performance report wdrTestNode.html.
openGauss=# \o

-- Generate the formatted performance report wdrTestCluster.html.
openGauss=# \o /home/om/wdrTestCluster.html

-- Write data into the performance report wdrTestCluster.html.
openGauss=# select generate_wdr_report(1, 2, 'all', 'cluster');

-- Close the performance report wdrTestCluster.html.
openGauss=# \o \a \t
Output format is aligned.
Tuples only is off.
```

