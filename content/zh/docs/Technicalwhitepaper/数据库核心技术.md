# 数据库核心技术<a name="ZH-CN_CONCEPT_0252569318"></a>

<!-- TOC -->

- [面向应用开发的基本功能](#面向应用开发的基本功能)
- [高性能](#高性能)
- [高扩展](#高扩展)
- [高可用](#高可用)
- [可维护性](#可维护性)
- [数据库安全](#数据库安全)

<!-- /TOC -->


## 面向应用开发的基本功能
-   支持标准SQL

    openGauss数据库支持标准的SQL。SQL标准是一个国际性的标准，定期会进行刷新。SQL标准的定义分成核心特性以及可选特性，绝大部分的数据库都没有100%支撑SQL标准。遗憾的是，SQL特性的构筑成为了数据库厂商吸引用户和提高应用迁移成本的手段，新的SQL特性在厂商之间差异越来越大，目前还没有机构来进行权威的SQL标准度的测试。

    openGauss数据库支持SQL:2011大部分的核心特性，同时还支持部分的可选特性，具体的特性列表可以参考《产品描述》中的[基本功能和特性](../Description/基本功能和特性.md)。

    标准SQL的引入为所有的数据库厂商提供统一的SQL界面，减少使用者的学习成本和应用openGauss程序的迁移代价。

-   支持标准开发接口

    提供业界标准的ODBC及JDBC接口，保证用户业务快速迁移至openGauss。

    目前支持标准的ODBC 3.5及JDBC 4.0接口，其中ODBC支持SUSE、Win32、Win64平台，JDBC无平台差异。

-   事务支持

    事务支持指的就是系统提供事务的能力，支持全局事务的ACID，保证事务的原子性、一致性、隔离性和持久性。

    事务支持及数据一致性保证是绝大多数数据库的基本功能，只有支持了事务，才能满足事务化的应用需求。

    -   A：atomicity 原子性

        整个事务中的所有操作，要么全部完成，要么全部不完成，不可能停滞在中间某个环节。

    -   C：consistency 一致性

        事务必须始终保持系统处于一致的状态，不管在任何给定的时间并发事务的数量。

    -   I： Isolation 隔离性

        隔离状态执行事务，使它们好像是系统在给定时间内执行的唯一操作。如果有两个事务，运行在相同的时间内，执行相同的功能，事务的隔离性将确保每一事务在系统中认为只有该事务在使用系统。

    -   D：Durability 持久性

        在事务完成以后，该事务对数据库所作的更改便持久的保存在数据库之中，并不会被回滚。

    支持事务的默认隔离级别是读已提交。保证不会读到脏数据。

    事务分为单语句事务和事务块，相关基础接口：

    -   Start transaction：事务开启
    -   Commit：事务提交
    -   Rollback：事务回滚

    另有[Set transaction](../Developerguide/SET-TRANSACTION.md)可设置隔离级别、读写模式或可推迟模式。

-   函数及存储过程支持

    函数和存储过程是数据库中的一种重要对象，主要功能将用户特定功能的SQL语句集进行封装，并方便调用。

    存储过程是SQL、PL/SQL的组合。存储过程可以使执行商业规则的代码从应用程序中移动到数据库。从而，代码存储一次能够被多个程序使用。

    1.  允许客户模块化程序设计，对SQL语句集进行封装，调用方便。
    2.  存储过程会进行编译缓存，可以提升用户执行SQL语句集的速度。
    3.  系统管理员通过执行某一存储过程的权限进行限制，能够实现对相应数据访问权限的限制，避免了非授权用户对数据的访问，保证了数据的安全。
    4.  为了处理SQL语句，存储过程进程分配一段内存区域来保存上下文联系。游标是指向上下文区域的句柄或指针。借助游标，存储过程可以控制上下文区域的变化。
    5.  支持6种异常信息级别方便客户对存储过程进行调试。支持存储过程调试，存储过程调试是一种调试手段，可以在存储过程开发中，一步一步跟踪存储过程执行的流程，根据变量的值，找到错误的原因或者程序的bug，提高问题定位效率。支持设置断点和单步调试。

    openGauss支持SQL标准中的函数及存储过程，增强了[存储过程](../Developerguide/存储过程.md)的易用性。

-   PG接口兼容

    兼容PSQL客户端，兼容PostgreSQL标准接口。

-   支持SQL hint

    支持SQL hint影响执行计划生成、提升SQL查询性能。

    Plan Hint为用户提供了直接影响执行计划生成的手段，用户可以通过指定join顺序，join、stream、scan方法，指定结果行数，等多个手段来进行执行计划的调优，以提升查询的性能。

-   Copy接口支持容错机制

    openGauss提供用户封装好的Copy错误表创建函数，并允许用户在使用Copy From指令时指定容错选项，使得Copy From语句在执行过程中部分解析、数据格式、字符集等相关的报错不会报错中断事务、而是被记录至错误表中，使得在Copy From的目标文件即使有少量数据错误也可以完成入库操作。用户随后可以在错误表中对相关的错误进行定位以及进一步排查。


## 高性能

### CBO优化器

openGauss优化器是典型的基于代价的优化 \(Cost-Based Optimization，简称CBO\)。在这种优化器模型下，数据库根据表的元组数、字段宽度、NULL记录比率、distinct值、MCV值、HB值等表的特征值，以及一定的代价计算模型，计算出每一个执行步骤的不同执行方式的输出元组数和执行代价\(cost\)，进而选出整体执行代价最小/首元组返回代价最小的执行方式进行执行。

CBO优化器能够在众多计划中依据代价选出最高效的执行计划，最大限度的满足客户业务要求。

### 行列混合存储

openGauss支持行存储和列存储两种存储模型，用户可以根据应用场景，建表的时候选择行存储还是列存储表。

一般情况下，如果表的字段比较多（大宽表），查询中涉及到的列不很多的情况下，适合列存储。如果表的字段个数比较少，查询大部分字段，那么选择行存储比较好。

列存储方式如[图1](#zh-cn_topic_0242724708_fig4487133722819)所示。

**图 1**  列存储示意图<a name="zh-cn_topic_0242724708_fig4487133722819"></a>  
<img src="figures/列存储示意图.png" title="列存储示意图" style="zoom: 50%;" />

在大宽表、数据量比较大的场景中，查询经常关注某些列，行存储引擎查询性能比较差。例如气象局的场景，单表有200\~800个列，查询经常访问10个列，在类似这样的场景下，向量化执行技术和列存储引擎可以极大的提升性能和减少存储空间。

行存表和列存表各有优劣，建议根据实际情况选择。

-   行存表

    默认创建表的类型。数据按行进行存储，即一行数据紧挨着存储。行存表支持完整的增删改查。适用于对数据需要经常更新的场景。

-   列存表

    数据按列进行存储，即一列所有数据紧挨着存储。单列查询IO小，比行存表占用更少的存储空间。适合数据批量插入、更新较少和以查询为主统计分析类的场景。列存表不适合点查询，insert插入单条记录性能差。


行存表和列存表的选择原则如下：

-   更新频繁程度

    数据如果频繁更新，选择行存表。

-   插入频繁程度

    频繁的少量插入，选择行存表。一次插入大批量数据，选择列存表。

-   表的列数

    表的列数很多，选择列存表。

-   查询的列数

    如果每次查询时，只涉及了表的少数（<50%总列数）几个列，选择列存表。

-   压缩率

    列存表比行存表压缩率高。但高压缩率会消耗更多的CPU资源。


### 自适应压缩

当前主流数据库通常都会采用数据压缩技术。数据类型不同，适用于它的压缩算法不同。对于相同类型的数据，其数据特征不同，采用不同的压缩算法达到的效果也不相同。自适用压缩正是从数据类型和数据特征出发，采用相应的压缩算法，实现了良好的压缩比、快速的入库性能以及良好的查询性能。

数据入库和频繁的海量数据查询是用户的主要应用场景。 在数据入库场景中，自适应压缩可以大幅度地减少数据量，成倍提高IO操作效率，将数据簇集存储，从而获得快速的入库性能。当用户进行数据查询时，少量的IO操作和快速的数据解压可以加快数据获取的速率，从而在更短的时间内得到查询结果。

目前，数据库已实现了RLE、DELTA、BYTEPACK/BITPACK、LZ4、ZLIB、LOCAL DICTIONARY等多种压缩算法。数据库支持的数据类型与压缩算法的映射关系如下表所示。

<a name="zh-cn_concept_0238164467_table57174405"></a>
<table><thead align="left"><tr id="zh-cn_concept_0238164467_row37135808"><th class="cellrowborder" valign="top" width="30.930000000000007%" id="mcps1.1.8.1.1"><p id="zh-cn_concept_0238164467_p55210503"><a name="zh-cn_concept_0238164467_p55210503"></a><a name="zh-cn_concept_0238164467_p55210503"></a>-</p>
</th>
<th class="cellrowborder" valign="top" width="8.250000000000002%" id="mcps1.1.8.1.2"><p id="zh-cn_concept_0238164467_p42865721"><a name="zh-cn_concept_0238164467_p42865721"></a><a name="zh-cn_concept_0238164467_p42865721"></a>RLE</p>
</th>
<th class="cellrowborder" valign="top" width="10.31%" id="mcps1.1.8.1.3"><p id="zh-cn_concept_0238164467_p49571392"><a name="zh-cn_concept_0238164467_p49571392"></a><a name="zh-cn_concept_0238164467_p49571392"></a>DELTA</p>
</th>
<th class="cellrowborder" valign="top" width="16.490000000000002%" id="mcps1.1.8.1.4"><p id="zh-cn_concept_0238164467_p55859844"><a name="zh-cn_concept_0238164467_p55859844"></a><a name="zh-cn_concept_0238164467_p55859844"></a>BITPACK/BYTEPACK</p>
</th>
<th class="cellrowborder" valign="top" width="9.280000000000001%" id="mcps1.1.8.1.5"><p id="zh-cn_concept_0238164467_p28353516"><a name="zh-cn_concept_0238164467_p28353516"></a><a name="zh-cn_concept_0238164467_p28353516"></a>LZ4</p>
</th>
<th class="cellrowborder" valign="top" width="10.31%" id="mcps1.1.8.1.6"><p id="zh-cn_concept_0238164467_p14933473"><a name="zh-cn_concept_0238164467_p14933473"></a><a name="zh-cn_concept_0238164467_p14933473"></a>ZLIB</p>
</th>
<th class="cellrowborder" valign="top" width="14.430000000000003%" id="mcps1.1.8.1.7"><p id="zh-cn_concept_0238164467_p1651786"><a name="zh-cn_concept_0238164467_p1651786"></a><a name="zh-cn_concept_0238164467_p1651786"></a>LOCAL DICTIONARY</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_concept_0238164467_row66685840"><td class="cellrowborder" valign="top" width="30.930000000000007%" headers="mcps1.1.8.1.1 "><p id="zh-cn_concept_0238164467_p32843930"><a name="zh-cn_concept_0238164467_p32843930"></a><a name="zh-cn_concept_0238164467_p32843930"></a>Smallint/int/bigint/Oid</p>
<p id="zh-cn_concept_0238164467_p27159916"><a name="zh-cn_concept_0238164467_p27159916"></a><a name="zh-cn_concept_0238164467_p27159916"></a>Decimal/real/double</p>
<p id="zh-cn_concept_0238164467_p43112656"><a name="zh-cn_concept_0238164467_p43112656"></a><a name="zh-cn_concept_0238164467_p43112656"></a>Money/time/date/</p>
<p id="zh-cn_concept_0238164467_p52469592"><a name="zh-cn_concept_0238164467_p52469592"></a><a name="zh-cn_concept_0238164467_p52469592"></a>timestamp</p>
</td>
<td class="cellrowborder" valign="top" width="8.250000000000002%" headers="mcps1.1.8.1.2 "><p id="zh-cn_concept_0238164467_p22178556"><a name="zh-cn_concept_0238164467_p22178556"></a><a name="zh-cn_concept_0238164467_p22178556"></a>√</p>
</td>
<td class="cellrowborder" valign="top" width="10.31%" headers="mcps1.1.8.1.3 "><p id="zh-cn_concept_0238164467_p51632641"><a name="zh-cn_concept_0238164467_p51632641"></a><a name="zh-cn_concept_0238164467_p51632641"></a>√</p>
</td>
<td class="cellrowborder" valign="top" width="16.490000000000002%" headers="mcps1.1.8.1.4 "><p id="zh-cn_concept_0238164467_p21494415"><a name="zh-cn_concept_0238164467_p21494415"></a><a name="zh-cn_concept_0238164467_p21494415"></a>√</p>
</td>
<td class="cellrowborder" valign="top" width="9.280000000000001%" headers="mcps1.1.8.1.5 "><p id="zh-cn_concept_0238164467_p63326029"><a name="zh-cn_concept_0238164467_p63326029"></a><a name="zh-cn_concept_0238164467_p63326029"></a>√</p>
</td>
<td class="cellrowborder" valign="top" width="10.31%" headers="mcps1.1.8.1.6 "><p id="zh-cn_concept_0238164467_p29134691"><a name="zh-cn_concept_0238164467_p29134691"></a><a name="zh-cn_concept_0238164467_p29134691"></a>√</p>
</td>
<td class="cellrowborder" valign="top" width="14.430000000000003%" headers="mcps1.1.8.1.7 "><p id="zh-cn_concept_0238164467_p11099770"><a name="zh-cn_concept_0238164467_p11099770"></a><a name="zh-cn_concept_0238164467_p11099770"></a>-</p>
</td>
</tr>
<tr id="zh-cn_concept_0238164467_row32789069"><td class="cellrowborder" valign="top" width="30.930000000000007%" headers="mcps1.1.8.1.1 "><p id="zh-cn_concept_0238164467_p38668936"><a name="zh-cn_concept_0238164467_p38668936"></a><a name="zh-cn_concept_0238164467_p38668936"></a>Tinterval/interval/Time with time zone/</p>
</td>
<td class="cellrowborder" valign="top" width="8.250000000000002%" headers="mcps1.1.8.1.2 "><p id="zh-cn_concept_0238164467_p45176087"><a name="zh-cn_concept_0238164467_p45176087"></a><a name="zh-cn_concept_0238164467_p45176087"></a>-</p>
</td>
<td class="cellrowborder" valign="top" width="10.31%" headers="mcps1.1.8.1.3 "><p id="zh-cn_concept_0238164467_p35384419"><a name="zh-cn_concept_0238164467_p35384419"></a><a name="zh-cn_concept_0238164467_p35384419"></a>-</p>
</td>
<td class="cellrowborder" valign="top" width="16.490000000000002%" headers="mcps1.1.8.1.4 "><p id="zh-cn_concept_0238164467_p47565651"><a name="zh-cn_concept_0238164467_p47565651"></a><a name="zh-cn_concept_0238164467_p47565651"></a>-</p>
</td>
<td class="cellrowborder" valign="top" width="9.280000000000001%" headers="mcps1.1.8.1.5 "><p id="zh-cn_concept_0238164467_p27612495"><a name="zh-cn_concept_0238164467_p27612495"></a><a name="zh-cn_concept_0238164467_p27612495"></a>-</p>
</td>
<td class="cellrowborder" valign="top" width="10.31%" headers="mcps1.1.8.1.6 "><p id="zh-cn_concept_0238164467_p22019648"><a name="zh-cn_concept_0238164467_p22019648"></a><a name="zh-cn_concept_0238164467_p22019648"></a>√</p>
</td>
<td class="cellrowborder" valign="top" width="14.430000000000003%" headers="mcps1.1.8.1.7 "><p id="zh-cn_concept_0238164467_p38761102"><a name="zh-cn_concept_0238164467_p38761102"></a><a name="zh-cn_concept_0238164467_p38761102"></a>-</p>
</td>
</tr>
<tr id="zh-cn_concept_0238164467_row13305603"><td class="cellrowborder" valign="top" width="30.930000000000007%" headers="mcps1.1.8.1.1 "><p id="zh-cn_concept_0238164467_p4012071"><a name="zh-cn_concept_0238164467_p4012071"></a><a name="zh-cn_concept_0238164467_p4012071"></a>Numeric/char/varchar/text/nvarchar2</p>
<p id="zh-cn_concept_0238164467_p36108639"><a name="zh-cn_concept_0238164467_p36108639"></a><a name="zh-cn_concept_0238164467_p36108639"></a>以及其他支持数据类型</p>
</td>
<td class="cellrowborder" valign="top" width="8.250000000000002%" headers="mcps1.1.8.1.2 "><p id="zh-cn_concept_0238164467_p39118642"><a name="zh-cn_concept_0238164467_p39118642"></a><a name="zh-cn_concept_0238164467_p39118642"></a>√</p>
</td>
<td class="cellrowborder" valign="top" width="10.31%" headers="mcps1.1.8.1.3 "><p id="zh-cn_concept_0238164467_p14493442"><a name="zh-cn_concept_0238164467_p14493442"></a><a name="zh-cn_concept_0238164467_p14493442"></a>√</p>
</td>
<td class="cellrowborder" valign="top" width="16.490000000000002%" headers="mcps1.1.8.1.4 "><p id="zh-cn_concept_0238164467_p33118134"><a name="zh-cn_concept_0238164467_p33118134"></a><a name="zh-cn_concept_0238164467_p33118134"></a>√</p>
</td>
<td class="cellrowborder" valign="top" width="9.280000000000001%" headers="mcps1.1.8.1.5 "><p id="zh-cn_concept_0238164467_p65323191"><a name="zh-cn_concept_0238164467_p65323191"></a><a name="zh-cn_concept_0238164467_p65323191"></a>√</p>
</td>
<td class="cellrowborder" valign="top" width="10.31%" headers="mcps1.1.8.1.6 "><p id="zh-cn_concept_0238164467_p56687084"><a name="zh-cn_concept_0238164467_p56687084"></a><a name="zh-cn_concept_0238164467_p56687084"></a>√</p>
</td>
<td class="cellrowborder" valign="top" width="14.430000000000003%" headers="mcps1.1.8.1.7 "><p id="zh-cn_concept_0238164467_p28251069"><a name="zh-cn_concept_0238164467_p28251069"></a><a name="zh-cn_concept_0238164467_p28251069"></a>√</p>
</td>
</tr>
</tbody>
</table>

例如，支持类手机号字符串的大整数压缩、支持numeric类型的大整数压缩、支持对压缩算法进行不同压缩水平的调整。

### 分区

在openGauss系统中，数据分区是将实例内部的数据集按照用户指定的策略作做一步拆分的水平分表，将表按照指定范围划分为多个数据互不重叠的部分。

对于大多数用户使用场景，分区表和普通表相比具有以下优点：

-   改善查询性能：对分区对象的查询可以仅搜索自己关心的分区，提高检索效率。
-   增强可用性：如果分区表的某个分区出现故障，表在其他分区的数据仍然可用。
-   方便维护：如果分区表的某个分区出现故障，需要修复数据，只修复该分区即可。
-   均衡I/O：可以把不同的分区映射到不同的磁盘以平衡I/O，改善整个系统性能。

目前openGauss数据库支持的分区表为范围分区表：将数据基于范围映射到每一个分区，这个范围是由创建分区表时指定的分区键决定的。这种分区方式是最为常用的。

范围分区功能，即根据表的一列或者多列，将要插入表的记录分为若干个范围（这些范围在不同的分区里没有重叠），然后为每个范围创建一个分区，用来存储相应的数据。用户在CREATE TABLE时增加PARTITION参数，即表示针对此表应用数据分区功能。

用户可以在实际使用中根据需要调整建表时的分区键，使每次查询结果尽可能存储在相同或者最少的分区内（称为“分区剪枝”），通过获取连续I/O大幅度提升查询性能。

实际业务中，时间经常被作为查询对象的过滤条件。因此，用户可考虑选择时间列为分区键，键值范围可根据总数据量、一次查询数据量调整。

### SQL by pass

在典型的OLTP场景中，简单查询占了很大一部分比例。这种查询的特征是只涉及单表和简单表达式的查询，因此为了加速这类查询，提出了SQL-BY-PASS框架，在parse层对这类查询做简单的模式判别后，进入到特殊的执行路径里，跳过经典的执行器执行框架，包括算子的初始化与执行、表达式与投影等经典框架，直接重写一套简洁的执行路径，并且直接调用存储接口，这样可以大大加速简单查询的执行速度。

### 鲲鹏NUMA架构优化

鲲鹏NUMA架构优化图如[图2](#fig1684262417126)所示。

**图 2**  鲲鹏NUMA架构优化图<a name="fig1684262417126"></a>  
![](figures/鲲鹏NUMA架构优化图.png "鲲鹏NUMA架构优化图")

1.  openGauss根据鲲鹏处理器的多核NUMA架构特点，进行针对性一系列NUMA架构相关优化，一方面尽量减少跨核内存访问的时延问题，另一方面充分发挥鲲鹏多核算力优势，所提供的关键技术包括重做日志批量插入，热点数据NUMA分布，CLog分区等，大幅提升TP系统的处理性能。
2.  openGauss基于鲲鹏芯片所使用的ARMv8.1架构，利用LSE扩展指令集实现高效的原子操作，有效提升CPU利用率，从而提升多线程间同步性能，XLog写入性能等。
3.  openGauss基于鲲鹏芯片提供的更宽的L3缓存cacheline，针对热点数据访问进行优化，有效提高缓存访问命中率，降低Cache缓存一致性维护开销，大幅提升系统整体的数据访问性能。

## 高扩展

**线程池高并发**

在OLTP领域中，数据库需要处理大量的客户端连接。因此，高并发场景的处理能力是数据库的重要能力之一。

对于外部连接最简单的处理模式是per-thread-per-connection模式，即来一个用户连接产生一个线程。这个模式好处是架构上处理简单，但是高并发下，由于线程太多，线程切换和数据库轻量级锁区域的冲突过大导致性能急剧下降，使得系统性能（吞吐量）严重下降，无法满足用户性能的SLA。

因此，需要通过线程资源池化复用的技术来解决该问题。线程池技术的整体设计思想是线程资源池化、并且在不同连接之间复用。系统在启动之后会根据当前核数或者用户配置启动固定一批数量的工作线程，一个工作线程会服务一到多个连接session，这样把session和thread进行了解耦。因为工作线程数是固定的，因此在高并发下不会导致线程的频繁切换，而由数据库层来进行session的调度管理。

## 高可用

### 主备机

为了保证故障的可恢复，需要将数据写多份，设置主备多个副本，通过日志进行数据同步，可以实现节点故障、停止后重启等情况下，openGauss能够保证故障之前的数据无丢失，满足ACID特性。主备环境可以支持主备和一主多备两种模式。主备模式下，备机需要重做日志，可以升主。在一主多备模式下，所有的备机都需要重做日志，都可以升主。主备主要用于一般可靠性的OLTP系统能够节省一定的存储资源。而一主多备提供更高的容灾能力，适合于更高可靠性事务处理的OLTP系统。

主备之间可以通过switchover进行角色切换，主机故障后可以通过failover对备机进行升主。

初始化安装或者备份恢复等场景中，需要根据主机重建备机的数据，此时需要build功能，将主机的数据和WAL日志发送到备机。主机故障后重新以备机的角色加入时，也需要build功能将其数据和日志与新主拉齐。Build包含全量build和增量build，全量build要全部依赖主机数据进行重建，拷贝的数据量比较大，耗时比较长，而增量build只拷贝差异文件，拷贝的数据量比较小，耗时比较短。一般情况下，优先选择增量build来进行故障恢复，如果增量build失败，再继续执行全量build，直至故障恢复。

openGauss除了流复制主备双机外，还支持逻辑复制，在逻辑复制中把主库称为源端库，备库称为目标端数据库，源端数据库根据预先指定好的逻辑解析规则对WAL文件进行解析，把DML操作解析成一定的逻辑变化信息（标准SQL语句），源端数据库把标准SQL语句发给目标端数据库，目标端数据库收到后进行应用，从而实现数据同步。逻辑复制只有DML操作。逻辑复制可以实现跨版本复制，异构数据库复制，双写数据库复制，表级别复制。

### 逻辑备份

openGauss提供逻辑备份能力，可以将用户表的数据以通用的text或者csv格式备份到本地磁盘文件，并在同构/异构数据库中恢复该用户表的数据。

### 物理备份

openGauss提供物理备份能力，可以将整个实例的数据以数据库内部格式备份到本地磁盘文件中，并在同构数据库中恢复整个实例的数据。

物理备份主要分为全量备份和增量备份，区别如下：全量备份包含备份时刻点上数据库的全量数据，耗时时间长（和数据库数据总量成正比），自身即可恢复出完整的数据库；增量备份只包含从指定时刻点之后的增量修改数据，耗时时间短（和增量数据成正比，和数据总量无关），但是必须要和全量备份数据一起才能恢复出完整的数据库。当前openGauss只支持全量备份。

### 恢复到指定时间点（PITR）

时间点恢复\(Point In Time Recovery\)基本原理是通过基础热备 + WAL预写日志 + WAL归档日志进行备份恢复。重放WAL记录的时候可以在任意点停止重放，这样就有一个在任意时间的数据库一致的快照。即可以把数据库恢复到自开始备份以来的任意时刻的状态。openGauss在恢复时可以指定恢复的停止点位置为TID，时间和LSN。

## 可维护性

### 支持WDR诊断报告

WDR\(Workload Diagnosis Report\)基于两次不同时间点系统的性能快照数据， 生成这两个时间点之间的性能表现报表，用于诊断数据库内核的性能故障。

WDR主要依赖两个组件：

-   SNAPSHOT性能快照：性能快照可以配置成按一定时间间隔从内核采集一定量的性能数据，持久化在用户表空间。任何一个SNAPSHOT可以作为一个性能基线，其他SNAPSHOT与之比较的结果，可以分析出与基线的性能表现。
-   WDR Reporter：报表生成工具基于两个SNAPSHOT，分析系统总体性能表现，并能计算出更多项具体的性能指标在这两个时间段之间的变化量，生成SUMMARY 和DETAIL两个不同级别的性能数据。如[表1](#zh-cn_concept_0238164494_table14895120191613)、[表2](#zh-cn_concept_0238164494_table23331848193120)所示。

**表 1**  SUMMARY级别诊断报告

<a name="zh-cn_concept_0238164494_table14895120191613"></a>
<table><thead align="left"><tr id="zh-cn_concept_0238164494_row1889513016163"><th class="cellrowborder" valign="top" width="24.77%" id="mcps1.2.3.1.1"><p id="zh-cn_concept_0238164494_p689512091618"><a name="zh-cn_concept_0238164494_p689512091618"></a><a name="zh-cn_concept_0238164494_p689512091618"></a>诊断类别</p>
</th>
<th class="cellrowborder" valign="top" width="75.22999999999999%" id="mcps1.2.3.1.2"><p id="zh-cn_concept_0238164494_p118951404165"><a name="zh-cn_concept_0238164494_p118951404165"></a><a name="zh-cn_concept_0238164494_p118951404165"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_concept_0238164494_row1189517019163"><td class="cellrowborder" valign="top" width="24.77%" headers="mcps1.2.3.1.1 "><p id="zh-cn_concept_0238164494_p16896205162"><a name="zh-cn_concept_0238164494_p16896205162"></a><a name="zh-cn_concept_0238164494_p16896205162"></a>Database Stat</p>
</td>
<td class="cellrowborder" valign="top" width="75.22999999999999%" headers="mcps1.2.3.1.2 "><p id="zh-cn_concept_0238164494_p7110144513222"><a name="zh-cn_concept_0238164494_p7110144513222"></a><a name="zh-cn_concept_0238164494_p7110144513222"></a>主要用于评估当前数据库上的负载和IO状况，负载和IO是衡量TP系统最最要的特性。</p>
<p id="zh-cn_concept_0238164494_p15896180171619"><a name="zh-cn_concept_0238164494_p15896180171619"></a><a name="zh-cn_concept_0238164494_p15896180171619"></a>包含当前连接到该数据库的session、提交和回滚的事务数、读取的磁盘块的数量、高速缓存中已经发现的磁盘块的次数、查询数据库返回的行数、查询数据库抓取的行数、查询数据库插入的行数、查询数据库更新的行数、查询数据库删除的行数、冲突和死锁发生的次数、临时文件的使用量、IO读写时间等。</p>
</td>
</tr>
<tr id="zh-cn_concept_0238164494_row589614018168"><td class="cellrowborder" valign="top" width="24.77%" headers="mcps1.2.3.1.1 "><p id="zh-cn_concept_0238164494_p2896170181618"><a name="zh-cn_concept_0238164494_p2896170181618"></a><a name="zh-cn_concept_0238164494_p2896170181618"></a>Load Profile</p>
</td>
<td class="cellrowborder" valign="top" width="75.22999999999999%" headers="mcps1.2.3.1.2 "><p id="zh-cn_concept_0238164494_p2089612013161"><a name="zh-cn_concept_0238164494_p2089612013161"></a><a name="zh-cn_concept_0238164494_p2089612013161"></a>从时间、IO、事务和SQL几个维度评估当前系统负载的表现。</p>
<p id="zh-cn_concept_0238164494_p161691350122212"><a name="zh-cn_concept_0238164494_p161691350122212"></a><a name="zh-cn_concept_0238164494_p161691350122212"></a>包含作业运行elapse time、CPU time、事务日质量、逻辑和物理读的量、读写IO次数和大小、登入登出次数、SQL、事务执行量、SQL P85和P90响应时间等。</p>
</td>
</tr>
<tr id="zh-cn_concept_0238164494_row889614011167"><td class="cellrowborder" valign="top" width="24.77%" headers="mcps1.2.3.1.1 "><p id="zh-cn_concept_0238164494_p11896801161"><a name="zh-cn_concept_0238164494_p11896801161"></a><a name="zh-cn_concept_0238164494_p11896801161"></a>Instance Efficiency Percentages</p>
</td>
<td class="cellrowborder" valign="top" width="75.22999999999999%" headers="mcps1.2.3.1.2 "><p id="zh-cn_concept_0238164494_p146120311858"><a name="zh-cn_concept_0238164494_p146120311858"></a><a name="zh-cn_concept_0238164494_p146120311858"></a>用于评估当前系统的缓存的效率。</p>
<p id="zh-cn_concept_0238164494_p1989610091613"><a name="zh-cn_concept_0238164494_p1989610091613"></a><a name="zh-cn_concept_0238164494_p1989610091613"></a>主要包含数据库缓存命中率。</p>
</td>
</tr>
<tr id="zh-cn_concept_0238164494_row189630111613"><td class="cellrowborder" valign="top" width="24.77%" headers="mcps1.2.3.1.1 "><p id="zh-cn_concept_0238164494_p148961007164"><a name="zh-cn_concept_0238164494_p148961007164"></a><a name="zh-cn_concept_0238164494_p148961007164"></a>Events</p>
</td>
<td class="cellrowborder" valign="top" width="75.22999999999999%" headers="mcps1.2.3.1.2 "><p id="zh-cn_concept_0238164494_p115276341657"><a name="zh-cn_concept_0238164494_p115276341657"></a><a name="zh-cn_concept_0238164494_p115276341657"></a>用于评估当前系统内核关键资源和关键事件的性能。</p>
<p id="zh-cn_concept_0238164494_p789680191613"><a name="zh-cn_concept_0238164494_p789680191613"></a><a name="zh-cn_concept_0238164494_p789680191613"></a>主要包含数据库内核关键时间的发生次数和时间的等待时间。</p>
</td>
</tr>
<tr id="zh-cn_concept_0238164494_row20583178178"><td class="cellrowborder" valign="top" width="24.77%" headers="mcps1.2.3.1.1 "><p id="zh-cn_concept_0238164494_p559717121712"><a name="zh-cn_concept_0238164494_p559717121712"></a><a name="zh-cn_concept_0238164494_p559717121712"></a>Wait Classes</p>
</td>
<td class="cellrowborder" valign="top" width="75.22999999999999%" headers="mcps1.2.3.1.2 "><p id="zh-cn_concept_0238164494_p11553691966"><a name="zh-cn_concept_0238164494_p11553691966"></a><a name="zh-cn_concept_0238164494_p11553691966"></a>用于评估当前系统关键事件类型的性能。</p>
<p id="zh-cn_concept_0238164494_p11595172176"><a name="zh-cn_concept_0238164494_p11595172176"></a><a name="zh-cn_concept_0238164494_p11595172176"></a>主要包含数据内核在主要的等待事件的种类上的发布：STATUS、LWLOCK_EVENT、LOCK_EVENT、IO_EVENT。</p>
</td>
</tr>
<tr id="zh-cn_concept_0238164494_row1737892971715"><td class="cellrowborder" valign="top" width="24.77%" headers="mcps1.2.3.1.1 "><p id="zh-cn_concept_0238164494_p1437872931714"><a name="zh-cn_concept_0238164494_p1437872931714"></a><a name="zh-cn_concept_0238164494_p1437872931714"></a>CPU</p>
</td>
<td class="cellrowborder" valign="top" width="75.22999999999999%" headers="mcps1.2.3.1.2 "><p id="zh-cn_concept_0238164494_p1437842910178"><a name="zh-cn_concept_0238164494_p1437842910178"></a><a name="zh-cn_concept_0238164494_p1437842910178"></a>主要包含CPU在用户态、内核态、Wait IO、空闲状态下的时间发布。</p>
</td>
</tr>
<tr id="zh-cn_concept_0238164494_row13154183712171"><td class="cellrowborder" valign="top" width="24.77%" headers="mcps1.2.3.1.1 "><p id="zh-cn_concept_0238164494_p515514378179"><a name="zh-cn_concept_0238164494_p515514378179"></a><a name="zh-cn_concept_0238164494_p515514378179"></a>IO Profile</p>
</td>
<td class="cellrowborder" valign="top" width="75.22999999999999%" headers="mcps1.2.3.1.2 "><p id="zh-cn_concept_0238164494_p13155133710173"><a name="zh-cn_concept_0238164494_p13155133710173"></a><a name="zh-cn_concept_0238164494_p13155133710173"></a>主要包含数据库Database IO次数、Database IO数据量、Redo IO次数、Redo IO量。</p>
</td>
</tr>
<tr id="zh-cn_concept_0238164494_row123476454170"><td class="cellrowborder" valign="top" width="24.77%" headers="mcps1.2.3.1.1 "><p id="zh-cn_concept_0238164494_p934714512178"><a name="zh-cn_concept_0238164494_p934714512178"></a><a name="zh-cn_concept_0238164494_p934714512178"></a>Memory Statistics</p>
</td>
<td class="cellrowborder" valign="top" width="75.22999999999999%" headers="mcps1.2.3.1.2 "><p id="zh-cn_concept_0238164494_p434712455175"><a name="zh-cn_concept_0238164494_p434712455175"></a><a name="zh-cn_concept_0238164494_p434712455175"></a>包含最大进程内存、进程已经使用内存、最大共享内存、已经使用共享内存大小等。</p>
</td>
</tr>
</tbody>
</table>

**表 2**  DETAIL 级别诊断报告

<a name="zh-cn_concept_0238164494_table23331848193120"></a>
<table><thead align="left"><tr id="zh-cn_concept_0238164494_row1533312481318"><th class="cellrowborder" valign="top" width="24.93%" id="mcps1.2.3.1.1"><p id="zh-cn_concept_0238164494_p5333948203119"><a name="zh-cn_concept_0238164494_p5333948203119"></a><a name="zh-cn_concept_0238164494_p5333948203119"></a>诊断类别</p>
</th>
<th class="cellrowborder" valign="top" width="75.07000000000001%" id="mcps1.2.3.1.2"><p id="zh-cn_concept_0238164494_p17333144823110"><a name="zh-cn_concept_0238164494_p17333144823110"></a><a name="zh-cn_concept_0238164494_p17333144823110"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_concept_0238164494_row1533315480312"><td class="cellrowborder" valign="top" width="24.93%" headers="mcps1.2.3.1.1 "><p id="zh-cn_concept_0238164494_p113331448163118"><a name="zh-cn_concept_0238164494_p113331448163118"></a><a name="zh-cn_concept_0238164494_p113331448163118"></a>Time Model</p>
</td>
<td class="cellrowborder" valign="top" width="75.07000000000001%" headers="mcps1.2.3.1.2 "><p id="zh-cn_concept_0238164494_p18455944461"><a name="zh-cn_concept_0238164494_p18455944461"></a><a name="zh-cn_concept_0238164494_p18455944461"></a>主要用于评估当前系统在时间维度的性能表现。</p>
<p id="zh-cn_concept_0238164494_p33332484313"><a name="zh-cn_concept_0238164494_p33332484313"></a><a name="zh-cn_concept_0238164494_p33332484313"></a>包含系统在各个阶段上消耗的时间：内核时间、CPU时间、执行时间、解析时间、编译时间、查询重写时间、计划生成时间、网络时间、IO时间。</p>
</td>
</tr>
<tr id="zh-cn_concept_0238164494_row1233374883113"><td class="cellrowborder" valign="top" width="24.93%" headers="mcps1.2.3.1.1 "><p id="zh-cn_concept_0238164494_p10333948163119"><a name="zh-cn_concept_0238164494_p10333948163119"></a><a name="zh-cn_concept_0238164494_p10333948163119"></a>SQL Statistics</p>
</td>
<td class="cellrowborder" valign="top" width="75.07000000000001%" headers="mcps1.2.3.1.2 "><p id="zh-cn_concept_0238164494_p367217315715"><a name="zh-cn_concept_0238164494_p367217315715"></a><a name="zh-cn_concept_0238164494_p367217315715"></a>主要用于SQL语句性能问题的诊断。</p>
<p id="zh-cn_concept_0238164494_p103331848113117"><a name="zh-cn_concept_0238164494_p103331848113117"></a><a name="zh-cn_concept_0238164494_p103331848113117"></a>包含归一化的SQL的性能指标在多个维度上的排序：Elapsed Time、CPU Time、Rows Returned、Tuples Reads、Executions、Physical Reads、Logical Reads。这些指标的种类包括：执行时间、执行次数、行活动、Cache IO等。</p>
</td>
</tr>
<tr id="zh-cn_concept_0238164494_row1933324873111"><td class="cellrowborder" valign="top" width="24.93%" headers="mcps1.2.3.1.1 "><p id="zh-cn_concept_0238164494_p183331348193119"><a name="zh-cn_concept_0238164494_p183331348193119"></a><a name="zh-cn_concept_0238164494_p183331348193119"></a>Wait Events</p>
</td>
<td class="cellrowborder" valign="top" width="75.07000000000001%" headers="mcps1.2.3.1.2 "><p id="zh-cn_concept_0238164494_p39281554285"><a name="zh-cn_concept_0238164494_p39281554285"></a><a name="zh-cn_concept_0238164494_p39281554285"></a>主要用于系统关键资源和关键时间的详细性能诊断。</p>
<p id="zh-cn_concept_0238164494_p933314823114"><a name="zh-cn_concept_0238164494_p933314823114"></a><a name="zh-cn_concept_0238164494_p933314823114"></a>包含所有关键事件在一段时间内的表现，主要是事件发生的次数和消耗的时间。</p>
</td>
</tr>
<tr id="zh-cn_concept_0238164494_row3334148183116"><td class="cellrowborder" valign="top" width="24.93%" headers="mcps1.2.3.1.1 "><p id="zh-cn_concept_0238164494_p4334204817319"><a name="zh-cn_concept_0238164494_p4334204817319"></a><a name="zh-cn_concept_0238164494_p4334204817319"></a>Cache IO Stats</p>
</td>
<td class="cellrowborder" valign="top" width="75.07000000000001%" headers="mcps1.2.3.1.2 "><p id="zh-cn_concept_0238164494_p77092138917"><a name="zh-cn_concept_0238164494_p77092138917"></a><a name="zh-cn_concept_0238164494_p77092138917"></a>用于诊断用户表和索引的性能。</p>
<p id="zh-cn_concept_0238164494_p73341848193110"><a name="zh-cn_concept_0238164494_p73341848193110"></a><a name="zh-cn_concept_0238164494_p73341848193110"></a>包含所有用户表和索引上的文件读写，缓存命中。</p>
</td>
</tr>
<tr id="zh-cn_concept_0238164494_row233424816311"><td class="cellrowborder" valign="top" width="24.93%" headers="mcps1.2.3.1.1 "><p id="zh-cn_concept_0238164494_p133474810318"><a name="zh-cn_concept_0238164494_p133474810318"></a><a name="zh-cn_concept_0238164494_p133474810318"></a>Utility status</p>
</td>
<td class="cellrowborder" valign="top" width="75.07000000000001%" headers="mcps1.2.3.1.2 "><p id="zh-cn_concept_0238164494_p178211436699"><a name="zh-cn_concept_0238164494_p178211436699"></a><a name="zh-cn_concept_0238164494_p178211436699"></a>用于诊断后端作业性能的诊断。</p>
<p id="zh-cn_concept_0238164494_p1334134843114"><a name="zh-cn_concept_0238164494_p1334134843114"></a><a name="zh-cn_concept_0238164494_p1334134843114"></a>包含页面操作和复制等后端操作的性能。</p>
</td>
</tr>
<tr id="zh-cn_concept_0238164494_row123341448113113"><td class="cellrowborder" valign="top" width="24.93%" headers="mcps1.2.3.1.1 "><p id="zh-cn_concept_0238164494_p11334848143110"><a name="zh-cn_concept_0238164494_p11334848143110"></a><a name="zh-cn_concept_0238164494_p11334848143110"></a>Object stats</p>
</td>
<td class="cellrowborder" valign="top" width="75.07000000000001%" headers="mcps1.2.3.1.2 "><p id="zh-cn_concept_0238164494_p14405135119915"><a name="zh-cn_concept_0238164494_p14405135119915"></a><a name="zh-cn_concept_0238164494_p14405135119915"></a>用于诊断数据库对象的性能。</p>
<p id="zh-cn_concept_0238164494_p6334174863119"><a name="zh-cn_concept_0238164494_p6334174863119"></a><a name="zh-cn_concept_0238164494_p6334174863119"></a>包含用户表和索引上的表、索引扫描活动、insert、update、delete活动、有效行数量、表维护操作的状态等。</p>
</td>
</tr>
<tr id="zh-cn_concept_0238164494_row1427793219359"><td class="cellrowborder" valign="top" width="24.93%" headers="mcps1.2.3.1.1 "><p id="zh-cn_concept_0238164494_p32775326355"><a name="zh-cn_concept_0238164494_p32775326355"></a><a name="zh-cn_concept_0238164494_p32775326355"></a>Configuration settings</p>
</td>
<td class="cellrowborder" valign="top" width="75.07000000000001%" headers="mcps1.2.3.1.2 "><p id="zh-cn_concept_0238164494_p1119216811109"><a name="zh-cn_concept_0238164494_p1119216811109"></a><a name="zh-cn_concept_0238164494_p1119216811109"></a>用于判断配置是够有变更。</p>
<p id="zh-cn_concept_0238164494_p142774327353"><a name="zh-cn_concept_0238164494_p142774327353"></a><a name="zh-cn_concept_0238164494_p142774327353"></a>包含当前所有配置参数的快照。</p>
</td>
</tr>
</tbody>
</table>


应用价值：

-   WDR报表是长期性能问题最主要的诊断手段。基于SNAPSHOT的性能基线，从多维度做性能分析，能帮助DBA 掌握系统负载繁忙程度，各个组件的性能表现，性能瓶颈。
-   SNAPSHOT也是后续性能问题自诊断和自优化建议的重要数据来源。

### 慢SQL诊断

慢SQL诊断分为两部分：实时慢SQL 和历史慢SQL。

-   实时慢SQL能根据用户提供的执行时间阈值，输出当前系统中正在执行的，且执行时间超过阈值的作业信息。
-   历史慢SQL能根据用户提供的执行时间阈值，记录所有超过阈值的执行完毕的作业信息。

历史慢SQL提供表和文件两种维度的查询接口，用户从接口中能查询到作业的执行计划，开始、结束执行时间，执行查询的语句，行活动，内核时间、CPU时间、执行时间、解析时间、编译时间、查询重写时间、计划生成时间、网络时间、IO时间等。所有信息都是脱敏的。

应用价值：

-   实时的慢SQL提供给用户管理尚未执行完毕的作业的接口，用户可以手动结束异常的，消耗过多资源的作业。
-   历史慢SQL提供给用户对于慢SQL诊断所需的详细信息，用户无需通过复现就能离线诊断特定慢SQL的性能问题。表和文件接口方便用户统计慢SQL指标，对接第三方平台。

### 支持一键式收集诊断信息

提供多种套件用于捕获、收集、分析诊断数据，使问题可以诊断，加速诊断过程。能根据开发和定位人员的需要，从生产环境中将必要的数据库日志、数据库管理日志、堆栈信息等提取出来，定位人员根据获得信息进行问题的定界定位。

一键式收集工具，根据生产环境中问题的不同，从生产环境中获取不同的信息，从而提高问题定位定界的效率。用户可以通过改写配置文件，收集自己想要的信息：

-   通过linux命令收集操作系统相关的信息。
-   通过查询系统表或者视图获得数据库系统相关的信息。
-   数据库系统运行日志和数据库管理相关的日志。
-   数据库系统的配置信息。
-   数据库相关进程产生的Core文件。
-   数据库相关进程的堆栈信息。
-   数据库进程产生的trace信息。
-   数据库产生的redo日志文件xlog。
-   计划复现信息。

## 数据库安全

### 访问控制

管理用户对数据库的访问控制权限，涵盖数据库系统权限和对象权限。

支持基于角色的访问控制机制，将角色和权限关联起来，通过将权限赋予给对应的角色，再将角色授予给用户，可实现用户访问控制权限管理。其中登录访问控制通过用户标识和认证技术来共同实现，而对象访问控制则基于用户在对象上的权限，通过对象权限检查实现对象访问控制。用户在为相关的数据库用户分配完成任务所需要的最小权限从而将数据库使用风险降到最低。

支持三权分立权限访问控制模型，数据库角色可分为系统管理员、安全管理员和审计管理员。其中安全管理员负责创建和管理用户，系统管理员负责授予和撤销用户权限，审计管理员负责审计所有用户的行为。

默认情况下，使用基于角色的访问控制模型。客户可通过设置参数来选择是否开启三权分立控制模型。

### 控制权和访问权分离

针对系统管理员用户，实现表对象的控制权和访问权分离，提高普通用户数据安全性，限制管理员对象访问权限。

该特性适用于如下场景，即对于有多个业务部门的企业，各部门间使用不同的数据库用户进行业务操作，同时存在同级别的数据库维护部门使用数据库管理员进行运维操作，业务部门希望在未经授权的情况下，管理员用户只能对各部门的数据进行控制操作（DROP、ALTER、TRUNCATE），但是不能进行访问操作（INSERT、DELETE、UPDATE、SELECT、COPY）。即针对管理员用户，表对象的控制权和访问权分离，提高用户数据的安全性。

系统管理员可以在创建用户时指定INDEPENDENT属性，表示该用户为私有用户。针对该用户的对象，数据库管理员（包含初始用户和其他管理员用户）在未经其授权前，只能进行控制操作（DROP、ALTER、TRUNCATE），无权进行INSERT、DELETE、SELECT、UPDATE、COPY、GRANT、REVOKE、ALTER  OWNER操作。

### 数据库加密认证

采用基于RFC5802机制的口令加密认证方法。

加密认证过程中采用单向Hash不可逆加密算法PBKDF2，可有效防止彩虹攻击。

创建用户所设置的口令被加密存储在系统表中。整个认证过程中口令加密存储和传输，通过计算相应的hash值并与服务端存储的值比较来进行正确性校验。

统一加密认证过程中的消息处理流程，可有效防止攻击者通过抓取报文猜解用户名或者口令的正确性。

### 数据库审计

审计日志记录用户对数据库的启停、连接、DDL、DML、DCL等操作。审计日志机制主要增强数据库系统对非法操作的追溯及举证能力。

用户可以通过参数配置对哪些语句或操作记录审计日志。

审计日志记录事件的时间、类型、执行结果、用户名、数据库、连接信息、数据库对象、数据库实例名称和端口号以及详细信息。支持按起止时间段查询审计日志，并根据记录的字段进行筛选。

数据库安全管理员可以利用这些日志信息，重现导致数据库现状的一系列事件，找出非法操作的用户、时间和内容等。

### 网络通信安全特性

支持通过SSL加密客户端和服务器之间的通信数据，保证客户的客户端与服务器通信安全。

采用TLS 1.2协议标准，并使用安全强度较高的加密算法套件，支持的加密算法套件如[表1](#zh-cn_topic_0238166170_table13251121491017)所示。

**表 1**  加密算法套件

<a name="zh-cn_topic_0238166170_table13251121491017"></a>
<table><thead align="left"><tr id="zh-cn_topic_0238166170_row1625261412109"><th class="cellrowborder" valign="top" width="31.03%" id="mcps1.2.3.1.1"><p id="zh-cn_topic_0238166170_p99755175105"><a name="zh-cn_topic_0238166170_p99755175105"></a><a name="zh-cn_topic_0238166170_p99755175105"></a>IANA编码</p>
</th>
<th class="cellrowborder" valign="top" width="68.97%" id="mcps1.2.3.1.2"><p id="zh-cn_topic_0238166170_p119751717121010"><a name="zh-cn_topic_0238166170_p119751717121010"></a><a name="zh-cn_topic_0238166170_p119751717121010"></a>IANA套件名</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0238166170_row92521414141017"><td class="cellrowborder" valign="top" width="31.03%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0238166170_p129756178106"><a name="zh-cn_topic_0238166170_p129756178106"></a><a name="zh-cn_topic_0238166170_p129756178106"></a>0x00,0x9F</p>
</td>
<td class="cellrowborder" valign="top" width="68.97%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0238166170_p697591721018"><a name="zh-cn_topic_0238166170_p697591721018"></a><a name="zh-cn_topic_0238166170_p697591721018"></a>TLS_DHE_RSA_WITH_AES_256_GCM_SHA384</p>
</td>
</tr>
<tr id="zh-cn_topic_0238166170_row1925251461012"><td class="cellrowborder" valign="top" width="31.03%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0238166170_p5975817131017"><a name="zh-cn_topic_0238166170_p5975817131017"></a><a name="zh-cn_topic_0238166170_p5975817131017"></a>0x00,0x9E</p>
</td>
<td class="cellrowborder" valign="top" width="68.97%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0238166170_p1497511781018"><a name="zh-cn_topic_0238166170_p1497511781018"></a><a name="zh-cn_topic_0238166170_p1497511781018"></a>TLS_DHE_RSA_WITH_AES_128_GCM_SHA256</p>
</td>
</tr>
<tr id="zh-cn_topic_0238166170_row172523141100"><td class="cellrowborder" valign="top" width="31.03%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0238166170_p597541715109"><a name="zh-cn_topic_0238166170_p597541715109"></a><a name="zh-cn_topic_0238166170_p597541715109"></a>0x00,0xA3</p>
</td>
<td class="cellrowborder" valign="top" width="68.97%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0238166170_p1097581731019"><a name="zh-cn_topic_0238166170_p1097581731019"></a><a name="zh-cn_topic_0238166170_p1097581731019"></a>TLS_DHE_DSS_WITH_AES_256_GCM_SHA384</p>
</td>
</tr>
<tr id="zh-cn_topic_0238166170_row11252121414107"><td class="cellrowborder" valign="top" width="31.03%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0238166170_p16975101718106"><a name="zh-cn_topic_0238166170_p16975101718106"></a><a name="zh-cn_topic_0238166170_p16975101718106"></a>0x00,0xA2</p>
</td>
<td class="cellrowborder" valign="top" width="68.97%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0238166170_p1497551717109"><a name="zh-cn_topic_0238166170_p1497551717109"></a><a name="zh-cn_topic_0238166170_p1497551717109"></a>TLS_DHE_DSS_WITH_AES_128_GCM_SHA256</p>
</td>
</tr>
<tr id="zh-cn_topic_0238166170_row192521714101013"><td class="cellrowborder" valign="top" width="31.03%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0238166170_p19750173100"><a name="zh-cn_topic_0238166170_p19750173100"></a><a name="zh-cn_topic_0238166170_p19750173100"></a>0x00,0x6B</p>
</td>
<td class="cellrowborder" valign="top" width="68.97%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0238166170_p497511175106"><a name="zh-cn_topic_0238166170_p497511175106"></a><a name="zh-cn_topic_0238166170_p497511175106"></a>TLS_DHE_RSA_WITH_AES_256_CBC_SHA256</p>
</td>
</tr>
<tr id="zh-cn_topic_0238166170_row12524148103"><td class="cellrowborder" valign="top" width="31.03%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0238166170_p297612173109"><a name="zh-cn_topic_0238166170_p297612173109"></a><a name="zh-cn_topic_0238166170_p297612173109"></a>0x00,0x67</p>
</td>
<td class="cellrowborder" valign="top" width="68.97%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0238166170_p119762017151012"><a name="zh-cn_topic_0238166170_p119762017151012"></a><a name="zh-cn_topic_0238166170_p119762017151012"></a>TLS_DHE_RSA_WITH_AES_128_CBC_SHA256</p>
</td>
</tr>
<tr id="zh-cn_topic_0238166170_row15252214111016"><td class="cellrowborder" valign="top" width="31.03%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0238166170_p1897617177107"><a name="zh-cn_topic_0238166170_p1897617177107"></a><a name="zh-cn_topic_0238166170_p1897617177107"></a>0x00,0x6A</p>
</td>
<td class="cellrowborder" valign="top" width="68.97%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0238166170_p11976141741011"><a name="zh-cn_topic_0238166170_p11976141741011"></a><a name="zh-cn_topic_0238166170_p11976141741011"></a>TLS_DHE_DSS_WITH_AES_256_CBC_SHA256</p>
</td>
</tr>
<tr id="zh-cn_topic_0238166170_row112521214131013"><td class="cellrowborder" valign="top" width="31.03%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0238166170_p17976131701016"><a name="zh-cn_topic_0238166170_p17976131701016"></a><a name="zh-cn_topic_0238166170_p17976131701016"></a>0x00,0x40</p>
</td>
<td class="cellrowborder" valign="top" width="68.97%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0238166170_p19976317161015"><a name="zh-cn_topic_0238166170_p19976317161015"></a><a name="zh-cn_topic_0238166170_p19976317161015"></a>TLS_DHE_DSS_WITH_AES_128_CBC_SHA256</p>
</td>
</tr>
<tr id="zh-cn_topic_0238166170_row1025317141104"><td class="cellrowborder" valign="top" width="31.03%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0238166170_p1297611179104"><a name="zh-cn_topic_0238166170_p1297611179104"></a><a name="zh-cn_topic_0238166170_p1297611179104"></a>0xC0,0x9F</p>
</td>
<td class="cellrowborder" valign="top" width="68.97%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0238166170_p3976141761020"><a name="zh-cn_topic_0238166170_p3976141761020"></a><a name="zh-cn_topic_0238166170_p3976141761020"></a>TLS_DHE_RSA_WITH_AES_256_CCM</p>
</td>
</tr>
<tr id="zh-cn_topic_0238166170_row16253131471014"><td class="cellrowborder" valign="top" width="31.03%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0238166170_p16976517101012"><a name="zh-cn_topic_0238166170_p16976517101012"></a><a name="zh-cn_topic_0238166170_p16976517101012"></a>0xC0,0x9E</p>
</td>
<td class="cellrowborder" valign="top" width="68.97%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0238166170_p897671781011"><a name="zh-cn_topic_0238166170_p897671781011"></a><a name="zh-cn_topic_0238166170_p897671781011"></a>TLS_DHE_RSA_WITH_AES_128_CCM</p>
</td>
</tr>
<tr id="zh-cn_topic_0238166170_row825321412109"><td class="cellrowborder" valign="top" width="31.03%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0238166170_p89761217121020"><a name="zh-cn_topic_0238166170_p89761217121020"></a><a name="zh-cn_topic_0238166170_p89761217121020"></a>0x00,0x39</p>
</td>
<td class="cellrowborder" valign="top" width="68.97%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0238166170_p1976121751010"><a name="zh-cn_topic_0238166170_p1976121751010"></a><a name="zh-cn_topic_0238166170_p1976121751010"></a>TLS_DHE_RSA_WITH_AES_256_CBC_SHA</p>
</td>
</tr>
<tr id="zh-cn_topic_0238166170_row5253151419107"><td class="cellrowborder" valign="top" width="31.03%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0238166170_p2097631721011"><a name="zh-cn_topic_0238166170_p2097631721011"></a><a name="zh-cn_topic_0238166170_p2097631721011"></a>0x00,0x33</p>
</td>
<td class="cellrowborder" valign="top" width="68.97%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0238166170_p11976517131019"><a name="zh-cn_topic_0238166170_p11976517131019"></a><a name="zh-cn_topic_0238166170_p11976517131019"></a>TLS_DHE_RSA_WITH_AES_128_CBC_SHA</p>
</td>
</tr>
<tr id="zh-cn_topic_0238166170_row1325371412101"><td class="cellrowborder" valign="top" width="31.03%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0238166170_p159761517131013"><a name="zh-cn_topic_0238166170_p159761517131013"></a><a name="zh-cn_topic_0238166170_p159761517131013"></a>0x00,0x38</p>
</td>
<td class="cellrowborder" valign="top" width="68.97%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0238166170_p1497691761016"><a name="zh-cn_topic_0238166170_p1497691761016"></a><a name="zh-cn_topic_0238166170_p1497691761016"></a>TLS_DHE_DSS_WITH_AES_256_CBC_SHA</p>
</td>
</tr>
<tr id="zh-cn_topic_0238166170_row72531141108"><td class="cellrowborder" valign="top" width="31.03%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0238166170_p189773178101"><a name="zh-cn_topic_0238166170_p189773178101"></a><a name="zh-cn_topic_0238166170_p189773178101"></a>0x00,0x32</p>
</td>
<td class="cellrowborder" valign="top" width="68.97%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0238166170_p89771717171013"><a name="zh-cn_topic_0238166170_p89771717171013"></a><a name="zh-cn_topic_0238166170_p89771717171013"></a>TLS_DHE_DSS_WITH_AES_128_CBC_SHA</p>
</td>
</tr>
</tbody>
</table>

### 行级访问控制

行级访问控制特性将数据库访问粒度控制到数据表行级别，使数据库达到行级访问控制的能力。不同用户执行相同的SQL查询操作，按照行访问控制策略，读取到的结果可能是不同的。

用户可以在数据表创建行访问控制\(Row  Level Security\)策略，该策略是指针对特定数据库用户、特定SQL操作生效的表达式。当数据库用户对数据表访问时，若SQL满足数据表特定的Row  Level Security策略，在查询优化阶段将满足条件的表达式，按照属性\(PERMISSIVE |  RESTRICTIVE\)类型，通过AND或OR方式拼接，应用到执行计划上。

行级访问控制的目的是控制表中行级数据可见性，通过在数据表上预定义Filter，在查询优化阶段将满足条件的表达式应用到执行计划上，影响最终的执行结果。当前行级访问控制支持的SQL语句包括SELECT，UPDATE，DELETE。
