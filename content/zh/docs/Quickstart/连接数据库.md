# 连接数据库<a name="ZH-CN_TOPIC_0241704272"></a>

在创建数据库连接之后，才能使用它来执行SQL语句操作数据。

## 函数原型<a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_s78385b36d75447f68647a4fa4e18e4eb"></a>

JDBC提供了三个方法，用于创建数据库连接。

-   DriverManager.getConnection\(String url\);
-   DriverManager.getConnection\(String url, Properties info\);
-   DriverManager.getConnection\(String url, String user, String password\);

## 参数<a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_sd1d6ca3f8a4345d78889ae70e3f20498"></a>

**表 1**  数据库连接参数

<a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_tfcd5d7b17d27423d9d3b648da394ac52"></a>
<table><thead align="left"><tr id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_r13c3173c830e468eb39e6aa804dfed59"><th class="cellrowborder" valign="top" width="13%" id="mcps1.2.3.1.1"><p id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a5501243843d34369bb879eed773000ae"><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a5501243843d34369bb879eed773000ae"></a><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a5501243843d34369bb879eed773000ae"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="87%" id="mcps1.2.3.1.2"><p id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a2939f7c5b53e49479763c806734c4f93"><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a2939f7c5b53e49479763c806734c4f93"></a><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a2939f7c5b53e49479763c806734c4f93"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_re1e62c9744ec489884f418b7f28dafe3"><td class="cellrowborder" valign="top" width="13%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a89d7b3d8fd624d06b353a9947f7905fe"><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a89d7b3d8fd624d06b353a9947f7905fe"></a><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a89d7b3d8fd624d06b353a9947f7905fe"></a>url</p>
</td>
<td class="cellrowborder" valign="top" width="87%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_aa712d56d1c1b48c7818432cfaf686c60"><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_aa712d56d1c1b48c7818432cfaf686c60"></a><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_aa712d56d1c1b48c7818432cfaf686c60"></a>gsjdbc4.jar数据库连接描述符。格式如下：</p>
<a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_ud24eb001d2c147738618d53304180b18"></a><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_ud24eb001d2c147738618d53304180b18"></a><ul id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_ud24eb001d2c147738618d53304180b18"><li>jdbc:postgresql:database</li><li>jdbc:postgresql://host/database</li><li>jdbc:postgresql://host:port/database</li></ul>
<div class="note" id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_na32bb62c928d4a4a96b51b226ee5631b"><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_na32bb62c928d4a4a96b51b226ee5631b"></a><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_na32bb62c928d4a4a96b51b226ee5631b"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="zh-cn_topic_0241234248_p1069826216120"><a name="zh-cn_topic_0241234248_p1069826216120"></a><a name="zh-cn_topic_0241234248_p1069826216120"></a>使用gsjdbc200.jar时，将“jdbc:postgresql”修改为“jdbc:gaussdb”</p>
<a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_u37354cd4fb1547e3973b70859e9fe729"></a><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_u37354cd4fb1547e3973b70859e9fe729"></a><ul id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_u37354cd4fb1547e3973b70859e9fe729"><li>database为要连接的数据库名称。</li><li>host为数据库服务器名称或IP地址。<p id="zh-cn_topic_0241234248_p1441610315219"><a name="zh-cn_topic_0241234248_p1441610315219"></a><a name="zh-cn_topic_0241234248_p1441610315219"></a>由于安全原因，数据库<span id="zh-cn_topic_0241234248_ph532563283216"><a name="zh-cn_topic_0241234248_ph532563283216"></a><a name="zh-cn_topic_0241234248_ph532563283216"></a>D</span>N禁止<span id="zh-cn_topic_0241234248_text41491904391"><a name="zh-cn_topic_0241234248_text41491904391"></a><a name="zh-cn_topic_0241234248_text41491904391"></a>openGauss</span>内部其他节点无认证接入。如果要在<span id="zh-cn_topic_0241234248_text1185692617459"><a name="zh-cn_topic_0241234248_text1185692617459"></a><a name="zh-cn_topic_0241234248_text1185692617459"></a>openGauss111</span>内部访问<span id="zh-cn_topic_0241234248_ph1143173593210"><a name="zh-cn_topic_0241234248_ph1143173593210"></a><a name="zh-cn_topic_0241234248_ph1143173593210"></a>D</span>N，请将JDBC程序部署在<span id="zh-cn_topic_0241234248_ph1138483920329"><a name="zh-cn_topic_0241234248_ph1138483920329"></a><a name="zh-cn_topic_0241234248_ph1138483920329"></a>D</span>N所在机器，host使用"127.0.0.1"。否则可能会出现“FATAL: Forbid remote connection with trust method!”错误。</p>
<p id="zh-cn_topic_0241234248_p572510297236"><a name="zh-cn_topic_0241234248_p572510297236"></a><a name="zh-cn_topic_0241234248_p572510297236"></a>建议业务系统单独部署在<span id="zh-cn_topic_0241234248_text15390151820398"><a name="zh-cn_topic_0241234248_text15390151820398"></a><a name="zh-cn_topic_0241234248_text15390151820398"></a>openGauss</span>外部，否则可能会影响数据库运行性能。</p>
</li><li>port为数据库服务器端口。</li></ul>
<p id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a0f37847b6f9c44ebacd95d8a7d5e1626"><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a0f37847b6f9c44ebacd95d8a7d5e1626"></a><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a0f37847b6f9c44ebacd95d8a7d5e1626"></a>缺省情况下，会尝试连接到localhost的<span id="zh-cn_topic_0241234248_text8396191484213"><a name="zh-cn_topic_0241234248_text8396191484213"></a><a name="zh-cn_topic_0241234248_text8396191484213"></a>8000</span>端口的database。</p>
</div></div>
</td>
</tr>
<tr id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_ref8dd9fc7790450ca15b4f30b96a0a18"><td class="cellrowborder" valign="top" width="13%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a1c692d258574463c90cbadc432be1c2e"><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a1c692d258574463c90cbadc432be1c2e"></a><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a1c692d258574463c90cbadc432be1c2e"></a>info</p>
</td>
<td class="cellrowborder" valign="top" width="87%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_aade6bbcac4be4b7cacc238da5173b93d"><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_aade6bbcac4be4b7cacc238da5173b93d"></a><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_aade6bbcac4be4b7cacc238da5173b93d"></a>数据库连接属性。常用的属性如下：</p>
<a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_u8546689def034a5a8257c477a574f39e"></a><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_u8546689def034a5a8257c477a574f39e"></a><ul id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_u8546689def034a5a8257c477a574f39e"><li>user：String类型。表示创建连接的数据库用户。</li><li>password：String类型。表示数据库用户的密码。</li><li>ssl：Boolean类型。表示是否使用SSL连接。</li><li>loggerLevel：string类型。为LogStream或LogWriter设置记录进DriverManager当前值的日志信息量。目前支持"OFF"、"DEBUG"和"TRACE"。 值为"DEBUG"时，表示只打印DEBUG级别以上的日志，将记录非常少的信息。值等于TRACE时，表示打印DEBUG和TRACE级别的日志，将产生详细的日志信息。默认值为OFF，表示不打印日志。</li><li>prepareThreshold：integer类型。用于确定在转换为服务器端的预备语句之前，要求执行方法PreparedStatement的次数。缺省值是5。</li><li>batchMode : boolean类型，用于确定是否使用batch模式连接。</li><li>fetchsize ： integer类型，用于设置数据库链接所创建statement的默认fetchsize。</li><li>ApplicationName：string类型。应用名称，在不做设置时，缺省值为PostgreSQL JDBC Driver。</li><li>allowReadOnly:boolean类型，用于设置connection是否允许设置readonly模式，默认为false，若该参数不被设置为true，则执行connnection.setReadOnly不生效。</li><li>blobMode:string类型，用于设置setBinaryStream方法为不同的数据类型赋值，设置为on时表示为blob数据类型赋值，设置为off时表示为bytea数据类型赋值，默认为on。</li><li>connectionExtraInfo：Boolean类型。表示驱动是否上报当前驱动的部署路径、进程属主用户到数据库。<div class="note" id="zh-cn_topic_0241234248_note177665024418"><a name="zh-cn_topic_0241234248_note177665024418"></a><a name="zh-cn_topic_0241234248_note177665024418"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="zh-cn_topic_0241234248_p197674018449"><a name="zh-cn_topic_0241234248_p197674018449"></a><a name="zh-cn_topic_0241234248_p197674018449"></a>取值范围：true或false，默认值为false。设置connectionExtraInfo为true，JDBC驱动会将当前驱动的部署路径、进程属主用户上报到数据库中，记录在connection_info参数里。</p>
</div></div>
</li></ul>
</td>
</tr>
<tr id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_r8005ff51ee3d40e184a8db722d0f18ae"><td class="cellrowborder" valign="top" width="13%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a925328f5c60948c98b489a99cbc20017"><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a925328f5c60948c98b489a99cbc20017"></a><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a925328f5c60948c98b489a99cbc20017"></a>user</p>
</td>
<td class="cellrowborder" valign="top" width="87%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a12ebd01bc95b4c2cbaf12561c10053df"><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a12ebd01bc95b4c2cbaf12561c10053df"></a><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a12ebd01bc95b4c2cbaf12561c10053df"></a>数据库用户。</p>
</td>
</tr>
<tr id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_rc74336c5bc0640da9b968c8b953ea76d"><td class="cellrowborder" valign="top" width="13%" headers="mcps1.2.3.1.1 "><p id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_ad02cd653ced04960aec39fa00ed2bb40"><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_ad02cd653ced04960aec39fa00ed2bb40"></a><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_ad02cd653ced04960aec39fa00ed2bb40"></a>password</p>
</td>
<td class="cellrowborder" valign="top" width="87%" headers="mcps1.2.3.1.2 "><p id="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a112a5bf510a14f4d95bd069bc1afc01a"><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a112a5bf510a14f4d95bd069bc1afc01a"></a><a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_a112a5bf510a14f4d95bd069bc1afc01a"></a>数据库用户的密码。</p>
</td>
</tr>
</tbody>
</table>

## 示例<a name="zh-cn_topic_0241234248_zh-cn_topic_0059779354_sa87cf707a76c493997989289921f9202"></a>

此示例将演示如何基于openGauss提供的JDBC接口开发应用程序。

```
//以下代码将获取数据库连接操作封装为一个接口，可通过给定用户名和密码来连接数据库。

public static Connection GetConnection(String username, String passwd)
    {
        //驱动类。
        String driver = "org.postgresql.Driver";
        //数据库连接描述符。
        String sourceURL = "jdbc:postgresql://10.10.0.13:8000/postgres";
        Connection conn = null;
        
        try
        {
            //加载驱动。
            Class.forName(driver);
        }
        catch( Exception e )
        {
            e.printStackTrace();
            return null;
        }
        
        try
        {
             //创建连接。
            conn = DriverManager.getConnection(sourceURL, username, passwd);
            System.out.println("Connection succeed!");
        }
        catch(Exception e)
        {
            e.printStackTrace();
            return null;
        }
        
        return conn;
    };
```

